{
  "version": 3,
  "sources": ["../src/EpubPaginator.ts"],
  "sourcesContent": ["/* eslint-disable no-console */\nimport { Book } from 'epubjs';\nimport { RenditionOptions } from 'epubjs/types/rendition';\nimport { EpubViewerBase, RelocatedEventPayload } from './EpubViewerBase';\n\nexport interface PaginateEventPayload {\n  pages: string[];\n  cfi: string;\n}\nexport class EpubPaginator extends EpubViewerBase {\n  public readonly pages: string[] = [];\n  private readonly container = document.createElement('div');\n  private working = false;\n  constructor(book: Book) {\n    super(book);\n    this.container.style.position = 'fixed';\n    this.container.style.left = '200vw';\n    document.body.append(this.container);\n    this.on('relocated', this.listenRelocate.bind(this));\n  }\n\n  public async paginate(options: RenditionOptions): Promise<string[]> {\n    this.working = true;\n    console.time('rendering all pages');\n    const waiter = new Promise<string[]>((resolve) => {\n      this.on('done', resolve);\n      this.on('terminated', resolve);\n    });\n    await this.display(this.container, options);\n    const pages = await waiter;\n    this.destroy();\n    console.timeEnd('rendering all pages');\n    return pages;\n  }\n\n  private listenRelocate({ location }: RelocatedEventPayload) {\n    this.pages.push(location.end.cfi);\n    this.emit('paginate', {\n      pages: this.pages,\n      cfi: location.end.cfi,\n    } as PaginateEventPayload);\n    if (location.atEnd) {\n      this.emit('done', this.pages);\n    } else if (this.working) {\n      this.rendition.next();\n    } else {\n      console.info('pagination stopped !');\n      this.emit('terminated', this.pages);\n    }\n  }\n\n  destroy() {\n    this.working = false;\n    this.removeAllListeners();\n    this.container.remove();\n    this.rendition.destroy();\n  }\n}\n"],
  "mappings": "AAGA;AAMO,mCAA4B,eAAe;AAAA,EAIhD,YAAY,MAAY;AACtB,UAAM;AAJQ,iBAAkB;AACjB,qBAAY,SAAS,cAAc;AAC5C,mBAAU;AAGhB,SAAK,UAAU,MAAM,WAAW;AAChC,SAAK,UAAU,MAAM,OAAO;AAC5B,aAAS,KAAK,OAAO,KAAK;AAC1B,SAAK,GAAG,aAAa,KAAK,eAAe,KAAK;AAAA;AAAA,QAGnC,SAAS,SAA8C;AAClE,SAAK,UAAU;AACf,YAAQ,KAAK;AACb,UAAM,SAAS,IAAI,QAAkB,CAAC,YAAY;AAChD,WAAK,GAAG,QAAQ;AAChB,WAAK,GAAG,cAAc;AAAA;AAExB,UAAM,KAAK,QAAQ,KAAK,WAAW;AACnC,UAAM,QAAQ,MAAM;AACpB,SAAK;AACL,YAAQ,QAAQ;AAChB,WAAO;AAAA;AAAA,EAGD,eAAe,EAAE,YAAmC;AAC1D,SAAK,MAAM,KAAK,SAAS,IAAI;AAC7B,SAAK,KAAK,YAAY;AAAA,MACpB,OAAO,KAAK;AAAA,MACZ,KAAK,SAAS,IAAI;AAAA;AAEpB,QAAI,SAAS,OAAO;AAClB,WAAK,KAAK,QAAQ,KAAK;AAAA,eACd,KAAK,SAAS;AACvB,WAAK,UAAU;AAAA,WACV;AACL,cAAQ,KAAK;AACb,WAAK,KAAK,cAAc,KAAK;AAAA;AAAA;AAAA,EAIjC,UAAU;AACR,SAAK,UAAU;AACf,SAAK;AACL,SAAK,UAAU;AACf,SAAK,UAAU;AAAA;AAAA;",
  "names": []
}
