{
  "version": 3,
  "sources": ["../src/StatefulPaginatedEpubViewer.ts"],
  "sourcesContent": ["import { RenditionOptions } from 'epubjs/types/rendition';\nimport {\n\tEpub,\n\tlibrary,\n\tBookInfo,\n\tPaginatedEpubViewer,\n\tRelocatedEventPayload,\n} from '.';\n\nexport class StatefulPaginatedEpubViewer extends PaginatedEpubViewer {\n\tprotected readonly bookInfo: BookInfo;\n\tconstructor(epub: Epub) {\n\t\tsuper(epub.content);\n\t\tthis.bookInfo = epub.info;\n\t\tthis.on('page-changed', this.persistPagination.bind(this));\n\t}\n\n\tprotected async persistPagination() {\n\t\tawait library.updateInfo(this.bookInfo);\n\t}\n\n\tpublic async display(element: Element, options?: RenditionOptions): Promise<void> {\n\t\tconst lastLocation = this.bookInfo.pagination.currentLocation?.end.cfi;\n\t\tawait super.display(\n\t\t\telement,\n\t\t\toptions,\n\t\t\tlastLocation,\n\t\t);\n\t\t\n\t\t// @ts-ignore\n\t\tif (this.rendition.currentLocation().end.cfi !== lastLocation) {\n\t\t\tconsole.warn(`Last location didn't load normal: ${lastLocation}`);\n\t\t\treturn this.goTo(lastLocation);\n\t\t}\n\t}\n\n\t/**\n\t * Skipping pagination if exists\n\t */\n\tprotected paginate() {\n\t\tif (\n\t\t\tthis.bookInfo.pagination.size.width === this.size.width &&\n\t\t\tthis.bookInfo.pagination.size.height === this.size.height\n\t\t) {\n\t\t\tthis.pages = this.bookInfo.pagination.pages;\n\t\t\tconsole.log('pagination will load from cache');\n\t\t} else {\n\t\t\treturn super.paginate();\n\t\t}\n\t}\n\n\tprotected registerEventListeners() {\n\t\tsuper.registerEventListeners();\n\t\t// rendition events\n\t\tthis.on('relocated', ({ location, chapter }: RelocatedEventPayload) => {\n\t\t\tthis.bookInfo.pagination.currentLocation = location;\n\t\t\tthis.bookInfo.pagination.currentChapter = chapter;\n\t\t\tthis.bookInfo.pagination.currentPage = this.currentPage;\n\t\t\tthis.emit('page-changed', this.bookInfo.pagination);\n\t\t});\n\n\t\t// pagination events\n\t\tthis.on('pagination-update', () => {\n\t\t\tthis.bookInfo.pagination.pages = this.pages;\n\t\t\tthis.bookInfo.pagination.currentPage = this.currentPage;\n\t\t\tthis.emit('page-changed', this.bookInfo.pagination);\n\t\t});\n\n\t\tthis.on('pagination-done', () => {\n\t\t\tthis.bookInfo.pagination.pages = this.pages;\n\t\t\tthis.bookInfo.pagination.size = this.size;\n\t\t\tthis.emit('page-changed', this.bookInfo.pagination);\n\t\t});\n\t}\n}\n"],
  "mappings": "AACA;AAAA;AAAA;AAAA;AAQO,iDAA0C,oBAAoB;AAAA,EAEpE,YAAY,MAAY;AACvB,UAAM,KAAK;AACX,SAAK,WAAW,KAAK;AACrB,SAAK,GAAG,gBAAgB,KAAK,kBAAkB,KAAK;AAAA;AAAA,QAGrC,oBAAoB;AACnC,UAAM,QAAQ,WAAW,KAAK;AAAA;AAAA,QAGlB,QAAQ,SAAkB,SAA2C;AArBnF;AAsBE,UAAM,eAAe,WAAK,SAAS,WAAW,oBAAzB,mBAA0C,IAAI;AACnE,UAAM,MAAM,QACX,SACA,SACA;AAID,QAAI,KAAK,UAAU,kBAAkB,IAAI,QAAQ,cAAc;AAC9D,cAAQ,KAAK,qCAAqC;AAClD,aAAO,KAAK,KAAK;AAAA;AAAA;AAAA,EAOT,WAAW;AACpB,QACC,KAAK,SAAS,WAAW,KAAK,UAAU,KAAK,KAAK,SAClD,KAAK,SAAS,WAAW,KAAK,WAAW,KAAK,KAAK,QAClD;AACD,WAAK,QAAQ,KAAK,SAAS,WAAW;AACtC,cAAQ,IAAI;AAAA,WACN;AACN,aAAO,MAAM;AAAA;AAAA;AAAA,EAIL,yBAAyB;AAClC,UAAM;AAEN,SAAK,GAAG,aAAa,CAAC,EAAE,UAAU,cAAqC;AACtE,WAAK,SAAS,WAAW,kBAAkB;AAC3C,WAAK,SAAS,WAAW,iBAAiB;AAC1C,WAAK,SAAS,WAAW,cAAc,KAAK;AAC5C,WAAK,KAAK,gBAAgB,KAAK,SAAS;AAAA;AAIzC,SAAK,GAAG,qBAAqB,MAAM;AAClC,WAAK,SAAS,WAAW,QAAQ,KAAK;AACtC,WAAK,SAAS,WAAW,cAAc,KAAK;AAC5C,WAAK,KAAK,gBAAgB,KAAK,SAAS;AAAA;AAGzC,SAAK,GAAG,mBAAmB,MAAM;AAChC,WAAK,SAAS,WAAW,QAAQ,KAAK;AACtC,WAAK,SAAS,WAAW,OAAO,KAAK;AACrC,WAAK,KAAK,gBAAgB,KAAK,SAAS;AAAA;AAAA;AAAA;",
  "names": []
}
