{
  "version": 3,
  "sources": ["../../src/utils/Epub.ts"],
  "sourcesContent": ["import { v4 as uuid } from 'uuid';\nimport fileDialog from 'file-dialog';\nimport loadEbpub, { Book, Location } from 'epubjs';\nimport { PackagingMetadataObject } from 'epubjs/types/packaging';\n\nexport interface Size2D {\n\twidth: number;\n\theight: number;\n}\n\nexport interface Pagination {\n\tsize: Size2D;\n\tpages: string[];\n\tcurrentPage: number | '-';\n\tcurrentChapter: string;\n\tcurrentLocation?: Location;\n}\nexport interface BookInfo extends PackagingMetadataObject {\n\tid: string;\n\tpagination: Pagination;\n}\n\nexport class Epub {\n\tprivate static async extractCover(book: Book) {\n\t\tawait book.loaded.cover;\n\t\tconst { coverPath } = book.packaging;\n\t\tif (coverPath) {\n\t\t\treturn book.archive.getBlob(book.resolve(coverPath));\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tpublic static load(content: ArrayBuffer): Book {\n\t\treturn loadEbpub(content);\n\t}\n\n\tpublic static async fromArrayBuffer(content: ArrayBuffer): Promise<Epub> {\n\t\tconst book = loadEbpub(content);\n\t\tconst cover = await this.extractCover(book);\n\t\tconst info: BookInfo = {\n\t\t\t...JSON.parse(JSON.stringify(book.packaging?.metadata)),\n\t\t\tcover,\n\t\t\tid: uuid(),\n\t\t\tpagination: {\n\t\t\t\tpages: [],\n\t\t\t\tcurrentPage: 1,\n\t\t\t\tcurrentChapter: '',\n\t\t\t\tsize: { width: 0, height: 0 },\n\t\t\t\tcurrentLocation: {\n\t\t\t\t\tstart: { displayed: { page: 0, total: -1 } },\n\t\t\t\t\tend: { displayed: { page: 0, total: -1 } },\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t\tawait book.destroy();\n\t\treturn new Epub(info, content);\n\t}\n\n\tpublic static async fromFileDialog(): Promise<Epub> {\n\t\tconst selectedFiles = await fileDialog({ accept: 'application/epub+zip' });\n\t\tconst content = await selectedFiles.item(0).arrayBuffer();\n\t\treturn this.fromArrayBuffer(content);\n\t}\n\n\tconstructor(\n\t\tpublic readonly info: BookInfo,\n\t\tpublic readonly content: ArrayBuffer,\n\t) {}\n}\n"],
  "mappings": "AAAA;AACA;AACA;AAoBO,kBAAW;AAAA,EA2CjB,YACiB,MACA,SACf;AAFe;AACA;AAAA;AAAA,eA5CI,aAAa,MAAY;AAC7C,UAAM,KAAK,OAAO;AAClB,UAAM,EAAE,cAAc,KAAK;AAC3B,QAAI,WAAW;AACd,aAAO,KAAK,QAAQ,QAAQ,KAAK,QAAQ;AAAA,WACnC;AACN,aAAO;AAAA;AAAA;AAAA,SAIK,KAAK,SAA4B;AAC9C,WAAO,UAAU;AAAA;AAAA,eAGE,gBAAgB,SAAqC;AArC1E;AAsCE,UAAM,OAAO,UAAU;AACvB,UAAM,QAAQ,MAAM,KAAK,aAAa;AACtC,UAAM,OAAiB;AAAA,SACnB,KAAK,MAAM,KAAK,UAAU,WAAK,cAAL,mBAAgB;AAAA,MAC7C;AAAA,MACA,IAAI;AAAA,MACJ,YAAY;AAAA,QACX,OAAO;AAAA,QACP,aAAa;AAAA,QACb,gBAAgB;AAAA,QAChB,MAAM,EAAE,OAAO,GAAG,QAAQ;AAAA,QAC1B,iBAAiB;AAAA,UAChB,OAAO,EAAE,WAAW,EAAE,MAAM,GAAG,OAAO;AAAA,UACtC,KAAK,EAAE,WAAW,EAAE,MAAM,GAAG,OAAO;AAAA;AAAA;AAAA;AAIvC,UAAM,KAAK;AACX,WAAO,IAAI,KAAK,MAAM;AAAA;AAAA,eAGH,iBAAgC;AACnD,UAAM,gBAAgB,MAAM,WAAW,EAAE,QAAQ;AACjD,UAAM,UAAU,MAAM,cAAc,KAAK,GAAG;AAC5C,WAAO,KAAK,gBAAgB;AAAA;AAAA;",
  "names": []
}
