{
  "version": 3,
  "sources": ["../src/EpubViewerBase.ts"],
  "sourcesContent": ["import EventEmitter from 'eventemitter3';\nimport Epub, { Contents, Rendition } from 'epubjs';\nimport { RenditionOptions, Location } from 'epubjs/types/rendition';\n\nexport interface Point2D {\n\tx: number;\n\ty: number;\n}\n\nexport interface TouchEvent {\n\tstart: Point2D;\n\tend: Point2D;\n\tmoved: boolean;\n}\n\nexport interface RelocatedEventPayload {\n\tlocation: Location;\n\tchapter?: string;\n}\n\nexport interface ContentEventPayload {\n\tcontents: Contents;\n\tview: Rendition;\n}\n\nexport class EpubViewerBase extends EventEmitter {\n\tprotected element: Element;\n\tprotected rendition: Rendition;\n\tprotected currentLocation: string;\n\tprotected currentChapter: string;\n\tconstructor(protected readonly book = Epub()) {\n\t\tsuper();\n\t}\n\n\tdestroy() {\n\t\tthis.book.destroy();\n\t}\n\n\tpublic get size() {\n\t\treturn {\n\t\t\twidth: this.element?.clientWidth,\n\t\t\theight: this.element?.clientHeight,\n\t\t};\n\t}\n\n\tpublic async initialize(input: ArrayBuffer) {\n\t\tawait this.book.open(input, 'binary');\n\t\tawait this.book.ready;\n\t\tawait this.book.loaded.navigation;\n\t}\n\n\tpublic display(\n\t\telement: Element,\n\t\toptions?: RenditionOptions,\n\t\ttarget?: string,\n\t) {\n\t\tthis.element = element;\n\t\tthis.rendition = this.book.renderTo(element, {\n\t\t\twidth: '100%',\n\t\t\theight: '100%',\n\t\t\t...options,\n\t\t\tallowScriptedContent: true,\n\t\t});\n\t\tthis.registerEventListeners();\n\t\tthis.registerThemes();\n\t\treturn this.rendition.display(target);\n\t}\n\n\tpublic goTo(target: string) {\n\t\tconsole.log(target);\n\t\tthis.rendition.display(target);\n\t}\n\n\tprotected registerEventListeners() {\n\t\t// rendition events\n\t\tthis.rendition.on('relocated', (location: Location) => {\n\t\t\tthis.currentLocation = location.end.cfi;\n\t\t\tthis.currentChapter = this.getChapter(location.start.href);\n\t\t\tthis.emit('relocated', {\n\t\t\t\tlocation,\n\t\t\t\tchapter: this.currentChapter,\n\t\t\t} as RelocatedEventPayload);\n\t\t});\n\t\tthis.rendition.hooks.content.register(\n\t\t\t(contents: Contents, view: Rendition) => {\n\t\t\t\tthis.emit('content', contents.document);\n\t\t\t},\n\t\t);\n\t\tthis.rendition.hooks.render.register((iframeView) => {\n\t\t\tthis.emit('render', iframeView.document);\n\t\t});\n\t\t// gestures events\n\t\tthis.listenRenditionGestureEvents();\n\t}\n\n\tprotected getChapter(href: string) {\n\t\tconst [toc] = this.book.navigation.toc.filter((toc) =>\n\t\t\ttoc.href.includes(href),\n\t\t);\n\t\treturn toc?.label.trim();\n\t}\n\n\tprotected registerThemes() {\n\t\tthis.rendition.themes.register('dark', {\n\t\t\tbody: {\n\t\t\t\tcolor: 'white',\n\t\t\t\t'font-size': 'x-large',\n\t\t\t\t'padding-top': '0 !important',\n\t\t\t\t'padding-bottom': '0 !important',\n\t\t\t},\n\t\t});\n\t\tthis.rendition.themes.register('light', {\n\t\t\tbody: {\n\t\t\t\tcolor: 'black',\n\t\t\t\t'font-size': 'x-large',\n\t\t\t\t'padding-top': '0 !important',\n\t\t\t\t'padding-bottom': '0 !important',\n\t\t\t},\n\t\t});\n\t\tthis.rendition.themes.select('light');\n\t\t// this.rendition.themes.register('lamp-reader', 'themse/lamp-reader.css');\n\t\t// this.rendition.themes.select('lamp-reader');\n\t}\n\n\tprivate handleEvent(event: TouchEvent) {\n\t\tif (!event.moved) {\n\t\t\treturn 'tap';\n\t\t} else if (event.end.x < event.start.x) {\n\t\t\t// swiped left!\n\t\t\treturn 'swipe:left';\n\t\t} else if (event.end.x > event.start.x) {\n\t\t\t// swiped right!\n\t\t\treturn 'swipe:right';\n\t\t}\n\t}\n\n\tprivate listenRenditionGestureEvents() {\n\t\tconst touchEvent = {\n\t\t\tstart: { x: 0, y: 0 },\n\t\t\tend: { x: 0, y: 0 },\n\t\t\tmoved: false,\n\t\t};\n\n\t\tthis.rendition.on('touchstart', (event) => {\n\t\t\ttouchEvent.moved = false;\n\t\t\ttouchEvent.start.x = event.changedTouches[0].screenX;\n\t\t\ttouchEvent.start.y = event.changedTouches[0].screenY;\n\t\t});\n\n\t\tthis.rendition.on('touchmove', () => {\n\t\t\ttouchEvent.moved = true;\n\t\t});\n\n\t\tthis.rendition.on('touchend', (event) => {\n\t\t\ttouchEvent.end.x = event.changedTouches[0].screenX;\n\t\t\ttouchEvent.end.y = event.changedTouches[0].screenY;\n\t\t\tconst gesture = this.handleEvent(touchEvent);\n\t\t\tthis.rendition.emit(gesture);\n\t\t});\n\t}\n}\n"],
  "mappings": "AAAA;AACA;AAwBO,oCAA6B,aAAa;AAAA,EAKhD,YAA+B,OAAO,QAAQ;AAC7C;AAD8B;AAAA;AAAA,EAI/B,UAAU;AACT,SAAK,KAAK;AAAA;AAAA,MAGA,OAAO;AAtCnB;AAuCE,WAAO;AAAA,MACN,OAAO,WAAK,YAAL,mBAAc;AAAA,MACrB,QAAQ,WAAK,YAAL,mBAAc;AAAA;AAAA;AAAA,QAIX,WAAW,OAAoB;AAC3C,UAAM,KAAK,KAAK,KAAK,OAAO;AAC5B,UAAM,KAAK,KAAK;AAChB,UAAM,KAAK,KAAK,OAAO;AAAA;AAAA,EAGjB,QACN,SACA,SACA,QACC;AACD,SAAK,UAAU;AACf,SAAK,YAAY,KAAK,KAAK,SAAS,SAAS;AAAA,MAC5C,OAAO;AAAA,MACP,QAAQ;AAAA,SACL;AAAA,MACH,sBAAsB;AAAA;AAEvB,SAAK;AACL,SAAK;AACL,WAAO,KAAK,UAAU,QAAQ;AAAA;AAAA,EAGxB,KAAK,QAAgB;AAC3B,YAAQ,IAAI;AACZ,SAAK,UAAU,QAAQ;AAAA;AAAA,EAGd,yBAAyB;AAElC,SAAK,UAAU,GAAG,aAAa,CAAC,aAAuB;AACtD,WAAK,kBAAkB,SAAS,IAAI;AACpC,WAAK,iBAAiB,KAAK,WAAW,SAAS,MAAM;AACrD,WAAK,KAAK,aAAa;AAAA,QACtB;AAAA,QACA,SAAS,KAAK;AAAA;AAAA;AAGhB,SAAK,UAAU,MAAM,QAAQ,SAC5B,CAAC,UAAoB,SAAoB;AACxC,WAAK,KAAK,WAAW,SAAS;AAAA;AAGhC,SAAK,UAAU,MAAM,OAAO,SAAS,CAAC,eAAe;AACpD,WAAK,KAAK,UAAU,WAAW;AAAA;AAGhC,SAAK;AAAA;AAAA,EAGI,WAAW,MAAc;AAClC,UAAM,CAAC,OAAO,KAAK,KAAK,WAAW,IAAI,OAAO,CAAC,SAC9C,KAAI,KAAK,SAAS;AAEnB,WAAO,2BAAK,MAAM;AAAA;AAAA,EAGT,iBAAiB;AAC1B,SAAK,UAAU,OAAO,SAAS,QAAQ;AAAA,MACtC,MAAM;AAAA,QACL,OAAO;AAAA,QACP,aAAa;AAAA,QACb,eAAe;AAAA,QACf,kBAAkB;AAAA;AAAA;AAGpB,SAAK,UAAU,OAAO,SAAS,SAAS;AAAA,MACvC,MAAM;AAAA,QACL,OAAO;AAAA,QACP,aAAa;AAAA,QACb,eAAe;AAAA,QACf,kBAAkB;AAAA;AAAA;AAGpB,SAAK,UAAU,OAAO,OAAO;AAAA;AAAA,EAKtB,YAAY,OAAmB;AACtC,QAAI,CAAC,MAAM,OAAO;AACjB,aAAO;AAAA,eACG,MAAM,IAAI,IAAI,MAAM,MAAM,GAAG;AAEvC,aAAO;AAAA,eACG,MAAM,IAAI,IAAI,MAAM,MAAM,GAAG;AAEvC,aAAO;AAAA;AAAA;AAAA,EAID,+BAA+B;AACtC,UAAM,aAAa;AAAA,MAClB,OAAO,EAAE,GAAG,GAAG,GAAG;AAAA,MAClB,KAAK,EAAE,GAAG,GAAG,GAAG;AAAA,MAChB,OAAO;AAAA;AAGR,SAAK,UAAU,GAAG,cAAc,CAAC,UAAU;AAC1C,iBAAW,QAAQ;AACnB,iBAAW,MAAM,IAAI,MAAM,eAAe,GAAG;AAC7C,iBAAW,MAAM,IAAI,MAAM,eAAe,GAAG;AAAA;AAG9C,SAAK,UAAU,GAAG,aAAa,MAAM;AACpC,iBAAW,QAAQ;AAAA;AAGpB,SAAK,UAAU,GAAG,YAAY,CAAC,UAAU;AACxC,iBAAW,IAAI,IAAI,MAAM,eAAe,GAAG;AAC3C,iBAAW,IAAI,IAAI,MAAM,eAAe,GAAG;AAC3C,YAAM,UAAU,KAAK,YAAY;AACjC,WAAK,UAAU,KAAK;AAAA;AAAA;AAAA;",
  "names": []
}
